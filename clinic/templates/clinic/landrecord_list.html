{% extends "clinic/base.html" %}

{% block content %}

<h2>Land Records</h2>

<p>
    <a href="{% url 'clinic:facility_list' %}" class="btn">
        ‚Üê Back to Facilities
    </a>
</p>

{% if object_list %}

<div style="overflow-x:auto;">

<form method="get" class="mb-3">
    <div class="row g-2">

        <!-- Facility Name Search -->
        <div class="col-md-5">
            <input
                type="text"
                name="search"
                class="form-control"
                placeholder="Search by facility name..."
                value="{{ request.GET.search }}"
            >
        </div>

        <br>

        <!-- Parcel Number Search -->
        <div class="col-md-5">
            <input
                type="text"
                name="parcel"
                class="form-control"
                placeholder="Search by parcel number..."
                value="{{ request.GET.parcel }}"
            >
        </div>

        <!-- Submit Button -->
        <div class="col-md-2">
            <button class="btn btn-primary w-100" type="submit">
                üîç Search
            </button>
        </div>

    </div>
</form>



<table class="table">
    <thead>
        <tr>
            <th>Parcel No</th>
            <th>Owner</th>
            <th>Facility</th>
            <th>Acreage</th>
            <th>Ownership</th>
            <th>Land Use</th>
            <th>Dispute</th>
            <th>Surveyed</th>
            <th>Acquired</th>
            <th>Value</th>
            <th>Document</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>

    <tbody>
    {% for record in object_list %}
        <tr>
            <td>{{ record.parcel_number|default:"‚Äî" }}</td>

            <td>{{ record.owner|default:"‚Äî" }}</td>

            <td>
                {{ record.facility.name }}
            </td>

            <td>{{ record.acreage }}</td>

            <td>{{ record.ownership_status|default:"‚Äî" }}</td>

            <td>{{ record.land_use|default:"‚Äî" }}</td>

            <td>{{ record.dispute_status|default:"‚Äî" }}</td>

            <td>
                {% if record.survey_status %}
                    ‚úÖ Yes
                {% else %}
                    ‚ùå No
                {% endif %}
            </td>

            <td>
                {{ record.acquisition_date|date:"Y-m-d"|default:"‚Äî" }}
            </td>

            <td>
                {% if record.fair_value %}
                    KSh {{ record.fair_value }}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>

            <td>
                {% if record.document %}
                    <a href="{{ record.document.url }}" target="_blank">
                        View
                    </a>
                {% else %}
                    ‚Äî
                {% endif %}
            </td>

            <td>
                {{ record.created_at|date:"Y-m-d" }}
            </td>
            <td>
                <a href="{% url 'clinic:landrecord_edit' record.pk %}" class="btn btn-sm">
                    Edit
                </a>
                <a href="{% url 'clinic:landrecord_delete' record.pk %}" 
                   onclick="return confirm('Are you sure you want to delete this record?');" class="btn btn-sm btn-danger">
                    Delete
                </a>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

</div>

{% else %}

<p>No land records found.</p>

{% endif %}

{% endblock %}
